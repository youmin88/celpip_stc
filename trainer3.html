<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sentence Trainer — Chunk Inputs (robust)</title>
  <style>
    :root { --gap: 10px; }
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; margin: 0; line-height: 1.5; }
    header, main { max-width: 900px; margin: 0 auto; padding: 16px; }
    header h1 { font-size: 1.4rem; margin: 0 0 8px; }
    header {  position: sticky;  top: 0;  z-index: 1000;  background: #fff;  border-bottom: 1px solid #e5e5e5; }
    @media (prefers-color-scheme: dark) {  header {    background: #0b0b0b;    border-bottom-color: #222;  }}
    .controls { display: flex; flex-wrap: wrap; gap: var(--gap); align-items: center; }
    button { padding: 8px 12px; border: 1px solid #bbb; border-radius: 8px; background: #f7f7f7; }
    button:active { transform: translateY(1px); }
    .status { margin-left: auto; color: #666; }
    .item { border: 1px solid #e3e3e3; border-radius: 12px; padding: 14px; margin-top: 12px; }
    .ko { color: #222; margin-bottom: 6px; }
    .masked, .full { padding: 10px; background: #fafafa; border-radius: 8px; }
    .full { margin-top: 6px; color: #666; font-size: .95rem; display: none; white-space: pre-wrap; }
    .masked { white-space: pre-wrap; }
    input.answer { display: inline-block; width: min(320px, 60vw); padding: 4px 6px; margin: 0 2px; border-radius: 6px; border: 1px solid #bbb; }
    input.answer.ok { border-color: #0a8; background: rgba(10,136,120,.06); }
    input.answer.bad { border-color: #c33; }
    .note { font-size: .85rem; color: #777; margin-top: 6px; }
    @media (prefers-color-scheme: dark) {
      body { background: #0b0b0b; color: #eaeaea; }
      .item { border-color: #333; }
      .masked, .full { background: #161616; }
      button { background: #222; color: #eee; border-color: #444; }
      .ko { color: #ddd; }
      .status { color: #aaa; }
      input.answer { border-color: #555; background: #0f0f0f; color: #eee; }
      .note { color: #aaa; }
    }
    header { position: sticky; top: 0; z-index: 1000; background: #fff; border-bottom: 1px solid #e5e5e5; }
    @media (prefers-color-scheme: dark) { header { background: #0b0b0b; border-bottom-color: #222; } }
  </style>
</head>
<body>
  <header>
    <h1>영/한 문장 — 겹치는 고정 구간(OVERLAP) 입력</h1>
    <div class="controls">
      <button id="toggleBtn">정답 보기/숨기기</button>
      <span class="status" id="globalStatus">전체 정답: 0 / 0</span>
    </div>
    <p class="note">고정 구간을 대소문자 무시로 찾아 빈칸으로 만듭니다. 못 찾으면 임시로 '~' 사이 청크 빈칸으로 대체합니다.</p>
  </header>

  <main id="root"></main>

  <script id="DATA" type="application/json">[
  {
    "en": "I would like to register a complaint about the poor customer service I received last week.",
    "ko": "지난주에 받은 불친절한 고객 서비스에 대해 불만을 제기하고자 합니다.",
    "en_sample": "I would like to register a complaint about ~"
  },
  {
    "en": "I am writing to inform you of the difficulties I experienced with my recent internet installation.",
    "ko": "최근 인터넷 설치 과정에서 겪은 어려움을 알려드리기 위해 이렇게 글을 씁니다.",
    "en_sample": "I am writing to inform you of the difficulties I experienced with ~"
  },
  {
    "en": "I am writing this email in response to your earlier email regarding the payment issue.",
    "ko": "이 메일은 귀하가 이전에 보내주신 요청에 대한 회신입니다.",
    "en_sample": "I am writing this email in response to your earlier email regarding ~"
  },
  {
    "en": "I noticed on the day that the package arrived damaged.",
    "ko": "그날 제품이 손상된 상태로 도착한 것을 발견했습니다.",
    "en_sample": "I noticed on the day that ~"
  },
  {
    "en": "I found this to be very disappointing as the delivery was delayed by over two weeks.",
    "ko": "배송 지연 때문에 매우 실망스러웠습니다.",
    "en_sample": "I found this to be very disappointing as ~"
  },
  {
    "en": "The delay is definitely having a negative impact on my schedule.",
    "ko": "지연은 제 일정에 분명히 부정적인 영향을 미쳤습니다.",
    "en_sample": "~ is definitely having a negative impact on ~"
  },
  {
    "en": "The refund process can in some cases be confusing, which is why a simpler form would be helpful.",
    "ko": "환불 절차가 복잡할 수 있으므로 간단한 양식이 도움이 될 것입니다.",
    "en_sample": "~ can in some cases be ~ which is why ~ would be helpful."
  },
  {
    "en": "Therefore, I expected better handling and care from your company.",
    "ko": "따라서 귀사로부터 더 나은 처리와 배려를 기대했습니다.",
    "en_sample": "Therefore, I expected better handling and care from ~"
  },
  {
    "en": "Not only that, but it was extremely difficult to reach your customer service line.",
    "ko": "그뿐만 아니라, 고객센터 연결이 매우 어려웠습니다.",
    "en_sample": "Not only that, ~"
  },
  {
    "en": "Moreover, the response time was far too long.",
    "ko": "게다가 응답 시간이 너무 길었습니다.",
    "en_sample": "Moreover, ~"
  },
  {
    "en": "May I suggest that for refund policies, you make the instructions clearer on your website?",
    "ko": "환불 정책에 대해 몇 가지 제안을 드리고자 합니다.",
    "en_sample": "May I suggest that for ~"
  },
  {
    "en": "I feel I have no recourse but to contact you now in the hopes that this issue can be resolved.",
    "ko": "문제가 해결되길 바라며 이렇게 연락드릴 수밖에 없었습니다.",
    "en_sample": "I feel I have no recourse but to contact you now in the hopes that ~"
  },
  {
    "en": "I request that you send a replacement product as soon as possible.",
    "ko": "빠른 교환을 요청드립니다.",
    "en_sample": "I request that ~"
  },
  {
    "en": "Please send me a new item in exchange for the damaged one.",
    "ko": "새로운 제품을 보내주시기 바랍니다.",
    "en_sample": "Please send me ~"
  },
  {
    "en": "Please contact me at your earliest convenience so that we may adjust the details of the return process.",
    "ko": "세부사항을 조정할 수 있도록 가능한 한 빨리 연락 부탁드립니다.",
    "en_sample": "Please contact me at your earliest convenience so that we may adjust the details of ~"
  },
  {
    "en": "The following is an account of the accident I witnessed on May 3rd at approximately 3 p.m.",
    "ko": "5월 3일 오후 3시경 제가 목격한 사고의 경위는 다음과 같습니다.",
    "en_sample": "The following is an account of the ~ I witnessed on ~ at approximately ~"
  },
  {
    "en": "I am writing to suggest some measures that the company can adopt so that it can operate more efficiently.",
    "ko": "회사가 효율적이 되도록 취할 수 있는 몇 가지 조치를 제안드리고자 합니다.",
    "en_sample": "I am writing to suggest some measures that ~ can adopt so that it can ~"
  },
  {
    "en": "Unfortunately, I noticed that there were several management issues.",
    "ko": "안타깝게도 몇 가지 관리 문제를 발견했습니다.",
    "en_sample": "Unfortunately, I noticed that ~"
  },
  {
    "en": "I am concerned because the frequent staff changes affect the service quality.",
    "ko": "직원 교대가 너무 잦아서 걱정됩니다.",
    "en_sample": "I am concerned because ~"
  },
  {
    "en": "As a result, I would like to suggest that you improve staff training to enhance customer satisfaction.",
    "ko": "결과적으로 고객만족도를 높이기 위한 개선을 제안드립니다.",
    "en_sample": "As a result, I would like to suggest that ~"
  },
  {
    "en": "Furthermore, you may consider implementing a staff feedback system.",
    "ko": "또한 직원 피드백 제도를 도입해보실 수 있습니다.",
    "en_sample": "Furthermore, you may consider ~"
  },
  {
    "en": "Thank you for your time and consideration.",
    "ko": "시간 내주시고 검토해주셔서 감사합니다.",
    "en_sample": "Thank you for your time and consideration."
  },
  {
    "en": "I look forward to hearing from you soon.",
    "ko": "곧 답변을 기다리겠습니다.",
    "en_sample": "I look forward to hearing from you soon."
  },
  {
    "en": "Thank you for the wonderful event you organized last weekend.",
    "ko": "멋진 행사를 열어주셔서 감사합니다.",
    "en_sample": "Thank you for the wonderful event ~"
  },
  {
    "en": "I had an enjoyable time interacting with the community during such an important celebration.",
    "ko": "뜻깊은 행사에서 지역사회와 교류하며 즐거운 시간을 보냈습니다.",
    "en_sample": "I had an enjoyable time interacting with the community during such an important celebration."
  },
  {
    "en": "I could tell that he was more concerned about keeping the schedule than ensuring customer satisfaction.",
    "ko": "그는 고객만족보다는 일정 관리에 더 신경 쓰고 있음을 알 수 있었습니다.",
    "en_sample": "I could tell that he was more concerned about ~ than ~"
  },
  {
    "en": "After following Daniel’s recommendations, the issue was resolved successfully.",
    "ko": "Daniel의 권장사항을 따른 후 문제는 해결되었습니다.",
    "en_sample": "After following ~ recommendations, the issue was resolved successfully."
  },
  {
    "en": "Thank you for your consideration and I look forward to another wonderful event next year.",
    "ko": "배려해주셔서 감사드리며, 내년에도 또 멋진 행사를 기대합니다.",
    "en_sample": "Thank you for your consideration and I look forward to another wonderful event next year."
  },
  {
    "en": "While I have tried to ask them to process my refund several times, it has been to no avail.",
    "ko": "제가 여러 번 요청했지만 아무런 소용이 없었습니다.",
    "en_sample": "While I have tried to ask them to ~ it has been to no avail."
  },
  {
    "en": "I feel that it was your duty as a manager to ensure the safety of your employees.",
    "ko": "관리자로서 직원의 안전을 보장하는 것은 귀하의 책임이었다고 생각합니다.",
    "en_sample": "I feel that it was your duty as ~ to ensure ~"
  },
  {
    "en": "There are a couple of options I can suggest to try to solve the delivery problem.",
    "ko": "배송 문제를 해결하기 위해 제가 제안드릴 수 있는 몇 가지 방안이 있습니다.",
    "en_sample": "There are a couple of options I can suggest to try to ~"
  },
  {
    "en": "If you would like to meet me in person to discuss the problem and my suggested solutions, I am available any time.",
    "ko": "문제와 제 제안을 직접 논의하고 싶으시다면 언제든 만남이 가능합니다.",
    "en_sample": "If you would like to meet me in person to discuss the problem and my suggested solutions, I am available any time."
  },
  {
    "en": "I look forward to your timely response.",
    "ko": "신속한 회신을 기다리겠습니다.",
    "en_sample": "I look forward to your timely response."
  },
  {
    "en": "No other passengers or vehicles were involved in the accident.",
    "ko": "그 사고에는 다른 승객이나 차량이 관련되지 않았습니다.",
    "en_sample": "No other passengers or vehicles were involved in the accident."
  },
  {
    "en": "A few weeks ago, I came to the main branch in need of assistance regarding a service issue.",
    "ko": "몇 주 전 저는 서비스 문제로 도움을 받기 위해 본사 지점을 방문했습니다.",
    "en_sample": "A few weeks ago, I came to ~ branch in need of assistance regarding ~"
  },
  {
    "en": "Upon arriving at the store, I was greeted by the staff, who was delightfully supportive and helpful.",
    "ko": "매장에 도착하자 직원이 매우 친절하고 도움이 되게 맞이해주었습니다.",
    "en_sample": "Upon arriving at the store, I was greeted by ~, who was delightfully supportive and helpful."
  },
  {
    "en": "It would be remissive of me not to lend him my strongest endorsement to his superiors.",
    "ko": "그를 상사에게 강력히 추천하지 않는다면 제 불찰일 것입니다.",
    "en_sample": "It would be remissive of me not to lend him my strongest endorsement to his superiors."
  },
  {
    "en": "I would recommend that the company keep on incorporating customer feedback.",
    "ko": "저는 회사가 지속적으로 고객 피드백을 반영하기를 권장합니다.",
    "en_sample": "I would recommend that ~ keep on ~"
  },
  {
    "en": "I personally believe that online education is the better choice.",
    "ko": "개인적으로 온라인 학습이 더 나은 선택이라고 생각합니다.",
    "en_sample": "I personally believe that ~ is the better choice."
  },
  {
    "en": "I firmly believe that the government should not have placed restrictions on free speech.",
    "ko": "저는 정부가 표현의 자유에 제약을 가해서는 안 된다고 확신합니다.",
    "en_sample": "I firmly believe that ~ should not have placed restrictions on ~"
  },
  {
    "en": "I am strongly in favor of keeping the public library as it is.",
    "ko": "저는 공공 도서관을 현재 상태로 유지하는 것에 강하게 찬성합니다.",
    "en_sample": "I am strongly in favor of keeping ~ as it is."
  },
  {
    "en": "Cell phones should definitely be allowed in schools.",
    "ko": "휴대전화 사용은 학교 내에서 반드시 허용되어야 합니다.",
    "en_sample": "~ should definitely be allowed in ~"
  },
  {
    "en": "Since one has to take priority over the other, I think that remote work is better.",
    "ko": "하지만 둘 중 하나를 선택해야 한다면, 저는 원격근무가 더 낫다고 생각합니다.",
    "en_sample": "Since one has to take priority over the other, I think that ~ is better."
  },
  {
    "en": "I think the current transportation system should be completely changed, or at least revised, for several reasons.",
    "ko": "현재의 교통 시스템은 여러 이유로 완전히 개선되어야 한다고 생각합니다.",
    "en_sample": "I think the current ~ should be completely changed, or at least revised, for several reasons."
  },
  {
    "en": "As we all know, fatty foods and generally all items rich in cholesterol have been proven to be harmful.",
    "ko": "우리가 모두 알다시피, 기름진 음식과 지방이 많은 모든 음식은 해롭다는 것이 입증되었습니다.",
    "en_sample": "As we all know, ~ and generally all items rich in ~ have been proven to be harmful."
  },
  {
    "en": "Furthering my opinion, the possibility of getting new equipment would be a big morale boost.",
    "ko": "제 의견을 덧붙이자면, 새로운 장비를 도입하면 직원들의 사기가 크게 높아질 것입니다.",
    "en_sample": "Furthering my opinion, the possibility of getting ~ would be a big morale boost."
  },
  {
    "en": "Moreover, having a factory downtown would mean more noise pollution.",
    "ko": "게다가 도심에 공장을 짓는 것은 소음 공해 증가를 의미할 것입니다.",
    "en_sample": "Moreover, ~ downtown would mean more ~"
  },
  {
    "en": "I realize that some people are pushing for the dress code to be exclusively casual, but doing so would definitely make some employees unhappy.",
    "ko": "일부 사람들이 직장 복장을 전적으로 캐주얼로 바꾸려 하지만, 그렇게 하면 일부 직원이 불만을 가질 것입니다.",
    "en_sample": "I realize that some people are pushing for ~ to be exclusively ~ but doing so would definitely make some ~ unhappy."
  },
  {
    "en": "While I acknowledge that some people might dislike the idea of online classes, I firmly support them as the better option.",
    "ko": "일부 사람들이 온라인 수업을 좋아하지 않을 수도 있지만, 저는 그것이 더 나은 선택이라고 확신합니다.",
    "en_sample": "While I acknowledge that some people might dislike the idea of ~ I firmly support them as the better option."
  },
  {
    "en": "For these reasons, I believe working from home is the better choice.",
    "ko": "이러한 이유로 저는 재택근무가 더 좋은 선택이라고 생각합니다.",
    "en_sample": "For these reasons, I believe ~ is the better choice."
  },
  {
    "en": "Thank you for giving me the chance to share my opinion on this issue.",
    "ko": "이 문제에 대해 제 의견을 말씀드릴 기회를 주셔서 감사합니다.",
    "en_sample": "Thank you for giving me the chance to share my opinion on this issue."
  },
  {
    "en": "I would like to thank you for your time and hope you will take my opinion into account when making your decision.",
    "ko": "제 의견을 고려해 주시길 바라며 시간을 내주셔서 감사합니다.",
    "en_sample": "I would like to thank you for your time and hope you will take my opinion into account when making your decision."
  },
  {
    "en": "I also believe that,",
    "ko": "나는 또한 ~라고 믿는다.",
    "en_sample": "I also believe that,"
  },
  {
    "en": "Additionally,",
    "ko": "또한,",
    "en_sample": "Additionally,"
  },
  {
    "en": "Moreover,",
    "ko": "게다가,",
    "en_sample": "Moreover,"
  },
  {
    "en": "Furthering my opinion,",
    "ko": "내 의견을 덧붙이자면,",
    "en_sample": "Furthering my opinion,"
  },
  {
    "en": "In addition",
    "ko": "추가로,",
    "en_sample": "In addition"
  },
  {
    "en": "because of,",
    "ko": "~때문에,",
    "en_sample": "because of,"
  },
  {
    "en": "as they result in,",
    "ko": "그들이 ~한 결과로,",
    "en_sample": "as they result in,"
  },
  {
    "en": "This would mean that",
    "ko": "이는 ~를 의미한다,",
    "en_sample": "This would mean that"
  },
  {
    "en": "On the one hand...",
    "ko": "한편으로는…,",
    "en_sample": "On the one hand..."
  },
  {
    "en": "On the other hand,",
    "ko": "다른 한편으로는…,",
    "en_sample": "On the other hand,"
  },
  {
    "en": "However,",
    "ko": "그러나,",
    "en_sample": "However,"
  },
  {
    "en": "While I recognise that,",
    "ko": "내가 ~라는 점을 인식하고는 있지만,",
    "en_sample": "While I recognise that,"
  },
  {
    "en": "While I do acknowledge that",
    "ko": "~라는 점을 인정하면서도,",
    "en_sample": "While I do acknowledge that"
  },
  {
    "en": "For those reasons,",
    "ko": "이러한 이유들로 인해,",
    "en_sample": "For those reasons,"
  },
  {
    "en": "in my opinion",
    "ko": "내 생각에는,",
    "en_sample": "in my opinion"
  },
  {
    "en": "I would recommend that",
    "ko": "나는 ~를 추천하고 싶다,",
    "en_sample": "I would recommend that"
  },
  {
    "en": "I personally think that",
    "ko": "나는 개인적으로 ~라고 생각한다,",
    "en_sample": "I personally think that"
  },
  {
    "en": "In my opinion",
    "ko": "내 의견으로는,",
    "en_sample": "In my opinion"
  },
  {
    "en": "I firmly believe that ",
    "ko": "나는 확고히 ~라고 믿는다,",
    "en_sample": "I firmly believe that "
  },
  {
    "en": "I am strongly in favour of",
    "ko": "나는 ~에 강하게 찬성한다,",
    "en_sample": "I am strongly in favour of"
  },
  {
    "en": "I am of the opinion that",
    "ko": "나는 ~라는 의견을 가지고 있다,",
    "en_sample": "I am of the opinion that"
  },
  {
    "en": "I would like to place on record that",
    "ko": "나는 공식적으로 ~라는 점을 기록에 남기고 싶다,",
    "en_sample": "I would like to place on record that"
  },
  {
    "en": "If I were you, I would suggest that you register for an online course.",
    "ko": "내가 너라면. 온라인 강좌에 등록하라고 제안하겠다.",
    "en_sample": "If I were you, I would suggest that you register for an online course."
  },
  {
    "en": "I hope my advice helps you make the best decision.",
    "ko": "내 조언이 네가 최선의 결정을 내리는 데 도움이 되길 바란다.",
    "en_sample": "I hope my advice helps you make the best decision."
  },
  {
    "en": "I’d like to share an experience that I had when I went on a family trip last month.",
    "ko": "지난달 가족 여행을 갔을 때의 경험을 공유하고 싶다.",
    "en_sample": "I’d like to share an experience that I had when I went on a family trip last month."
  },
  {
    "en": "It was a great experience that I’ll never forget.",
    "ko": "그것은 내가 절대 잊지 못할 멋진 경험이었다.",
    "en_sample": "It was a great experience that I’ll never forget."
  },
  {
    "en": "In this picture, I can see a family enjoying their time together in a park.",
    "ko": "이 그림에서 나는 공원에서 함께 시간을 보내는 가족을 볼 수 있다.",
    "en_sample": "In this picture, I can see a family enjoying their time together in a park."
  },
  {
    "en": "That’s what I can see in this picture.",
    "ko": "이것이 내가 이 그림에서 볼 수 있는 전부이다.",
    "en_sample": "That’s what I can see in this picture."
  },
  {
    "en": "In this picture, I’ll describe what I think will probably happen next.",
    "ko": "이 그림에서 다음에 일어날 일에 대해 내가 생각하는 바를 설명하겠다.",
    "en_sample": "In this picture, I’ll describe what I think will probably happen next."
  },
  {
    "en": "That’s my prediction based on what I can see.",
    "ko": "이것이 내가 볼 수 있는 것을 바탕으로 한 나의 예측이다.",
    "en_sample": "That’s my prediction based on what I can see."
  },
  {
    "en": "Between these two options, I would choose working from home because it’s more convenient.",
    "ko": "두 가지 선택지 중에서, 나는 재택근무를 선택하겠다. 그게 더 편리하기 때문이다.",
    "en_sample": "Between these two options, I would choose working from home because it’s more convenient."
  },
  {
    "en": "I hope you’ll agree that this is the better choice.",
    "ko": "이 선택이 더 나은 선택이라고 네가 동의하길 바란다.",
    "en_sample": "I hope you’ll agree that this is the better choice."
  },
  {
    "en": "I’d like to explain the situation and ask for your help regarding my delayed payment.",
    "ko": "지연된 결제 건에 대해 상황을 설명하고 도움을 요청하고 싶다.",
    "en_sample": "I’d like to explain the situation and ask for your help regarding my delayed payment."
  },
  {
    "en": "Thank you for your time and understanding.",
    "ko": "시간을 내어 주시고 이해해 주셔서 감사하다.",
    "en_sample": "Thank you for your time and understanding."
  },
  {
    "en": "Personally, I believe that public transportation is a better option than driving a car.",
    "ko": "개인적으로 나는 대중교통이 자동차 운전보다 더 나은 선택이라고 생각한다.",
    "en_sample": "Personally, I believe that public transportation is a better option than driving a car."
  },
  {
    "en": "Thank you for giving me the chance to share my view.",
    "ko": "내 의견을 말할 기회를 주셔서 감사하다.",
    "en_sample": "Thank you for giving me the chance to share my view."
  },
  {
    "en": "I’m calling because something unexpected happened and I need to cancel my reservation.",
    "ko": "예기치 못한 일이 생겨서 예약을 취소해야 하기 때문에 전화드렸다.",
    "en_sample": "I’m calling because something unexpected happened and I need to cancel my reservation."
  },
  {
    "en": "I hope this issue can be resolved as soon as possible.",
    "ko": "이 문제가 가능한 한 빨리 해결되길 바란다.",
    "en_sample": "I hope this issue can be resolved as soon as possible."
  }
]</script>

  <script>
    function findFixedSpansCI(enSample, enTemplate) {
      const parts = String(enTemplate || "").split("~");
      const s = String(enSample || "");
      const sL = s.toLowerCase();
      const spans = [];
      let posL = 0;
      for (let i=0;i<parts.length;i++) {
        const p = parts[i];
        if (!p) continue;
        const pL = p.toLowerCase();
        const idxL = sL.indexOf(pL, posL);
        if (idxL === -1) return [];
        spans.push({start: idxL, end: idxL + p.length, text: s.slice(idxL, idxL + p.length)});
        posL = idxL + p.length;
      }
      return spans;
    }

    function findGapChunks(enSample, enTemplate) {
      const parts = String(enTemplate || "").split("~");
      const s = String(enSample || "");
      const spans = [];
      let pos = 0;
      function indexOfFrom(hay, needle, from) {
        if (!needle) return from;
        return hay.indexOf(needle, from);
      }
      const matches = [];
      for (let i=0;i<parts.length;i++) {
        const p = parts[i];
        const idx = indexOfFrom(s, p, pos);
        if (idx === -1) return [];
        matches.push({start: idx, end: idx + p.length});
        pos = idx + p.length;
      }
      for (let i=0;i<matches.length-1;i++) {
        const left = matches[i], right = matches[i+1];
        const start = left.end, end = right.start;
        if (end >= start) spans.push({start, end, text: s.slice(start, end)});
      }
      if (parts.length > 0 && parts[0] === "") {
        const firstStart = matches[0].start;
        if (firstStart > 0) spans.unshift({start: 0, end: firstStart, text: s.slice(0, firstStart)});
      }
      if (parts.length > 0 && parts[parts.length-1] === "") {
        const lastEnd = matches[matches.length-1].end;
        if (lastEnd < s.length) spans.push({start: lastEnd, end: s.length, text: s.slice(lastEnd)});
      }
      return spans;
    }

    function renderMaskedLine(enSample, spans, noteFallback) {
      const container = document.createElement("div");
      container.className = "masked";
      let cursor = 0;
      spans.sort((a,b)=>a.start-b.start);
      for (const span of spans) {
        if (span.start > cursor) container.append(enSample.slice(cursor, span.start));
        const inp = document.createElement("input");
        inp.type = "text";
        inp.className = "answer";
        inp.setAttribute("data-ans", span.text);
        function check() {
          const ok = inp.value.trim() === inp.dataset.ans.trim();
          inp.classList.toggle("ok", ok);
          inp.classList.toggle("bad", !ok && inp.value.length > 0);
          updateGlobal();
        }
        inp.addEventListener("input", check);
        inp.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const inputs = Array.from(document.querySelectorAll("input.answer"));
            const i = inputs.indexOf(inp);
            if (i >= 0 && i < inputs.length - 1) {
              inputs[i+1].focus();
              inputs[i+1].select();
            }
          }
        });
        container.appendChild(inp);
        cursor = span.end;
      }
      if (cursor < enSample.length) container.append(enSample.slice(cursor));
      if (noteFallback) {
        const n = document.createElement("div");
        n.className = "note";
        n.textContent = "고정 구간을 찾지 못해 임시로 청크(~) 구간을 빈칸으로 대체했습니다.";
        container.appendChild(n);
      }
      return container;
    }

    const root = document.getElementById("root");
    const toggleBtn = document.getElementById("toggleBtn");
    const globalStatus = document.getElementById("globalStatus");
    let reveal = false;

    function renderAll(DATA) {
      root.innerHTML = "";
      DATA.forEach(item => {
        const sec = document.createElement("section");
        sec.className = "item";

        const ko = document.createElement("div");
        ko.className = "ko";
        ko.textContent = item.ko || "";
        sec.appendChild(ko);

        let spans = findFixedSpansCI(item.en || "", item.en_sample || "");
        let usedFallback = false;
        if (!spans.length) {
          spans = findGapChunks(item.en_sample || "", item.en || "");
          usedFallback = true;
        }
        const masked = renderMaskedLine(item.en || "", spans, usedFallback);
        sec.appendChild(masked);

        const full = document.createElement("div");
        full.className = "full";
        full.textContent = item.en || "";
        if (reveal) full.style.display = "block";
        sec.appendChild(full);

        root.appendChild(sec);
      });
      updateGlobal();
    }

    function updateGlobal() {
      const inputs = Array.from(document.querySelectorAll("input.answer"));
      const correct = inputs.filter(inp => inp.value.trim() === inp.dataset.ans.trim()).length;
      globalStatus.textContent = "전체 정답: " + correct + " / " + inputs.length;
    }

    let DATA = [];
    try {
      DATA = JSON.parse(document.getElementById("DATA").textContent);
    } catch(e) {
      alert("데이터 파싱 오류: " + e.message);
      DATA = [];
    }
    renderAll(DATA);

    toggleBtn.addEventListener("click", () => {
      reveal = !reveal;
      document.querySelectorAll(".full").forEach(el => {
        el.style.display = reveal ? "block" : "none";
      });
    });
  </script>
</body>
</html>